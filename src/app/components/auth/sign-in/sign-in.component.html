<div class="flex flex-wrap justify-between h-screen">
  <div class="w-full md:w-[50%]   flex flex-col justify-center">
    <h2 class="text-[32px] font-bold text-gray-900 text-center">مرحبًا بعودتك</h2>
    <p class="text-sm text-gray-500 mb-6 text-center">يرجى تسجيل الدخول لمتابعة ما فاتك</p>



    <!-- تسجيل الدخول بالبريد -->
    @if (loginMethod === 'email') {


    <button class="text-red-600 font-bold underline text-sm mb-4 block mx-auto" (click)="switchLoginMethod()">
      الدخول عبر رقم الجوال و رمز OTP
    </button>


    <form [formGroup]="loginForm_user_pass" (ngSubmit)="check_email_login()" class="max-w-sm mx-auto">
      <div class="mb-5">
        <label class="block mb-2 text-sm font-medium">رقم الجوال</label>
        <input type="text" autocomplete="mobile" maxlength="10" formControlName="phoneNumber" class="input"
          placeholder="ادخل رقم الجوال" />
        @if (loginForm_user_pass.get('phoneNumber')?.touched && loginForm_user_pass.get('phoneNumber')?.invalid) {
        @if (loginForm_user_pass.get('phoneNumber')?.errors?.['required']) {
        <span class="px-2 text-xs text-red-600 mt-1 block">رقم مطلوب</span>
        }
        @if (loginForm_user_pass.get('phoneNumber')?.errors?.['pattern']) {
        <span class="px-2 text-xs text-red-600 mt-1 block">رقم غير صحيح</span>
        }
        }
      </div>
      <div class="mb-5">
        <label class="block mb-2 text-sm font-medium">كلمة المرور</label>
        <input type="text" formControlName="password" class="input" placeholder="ادخل كلمة المرور" />
        @if (loginForm_user_pass.get('password')?.touched && loginForm_user_pass.get('password')?.invalid) {
        @if (loginForm_user_pass.get('password')?.errors?.['required']) {
        <span class="px-2 text-xs text-red-600 mt-1 block">كلمة المرور مطلوبة</span>
        }
        @if (loginForm_user_pass.get('password')?.errors?.['minlength']) {
        <span class="px-2 text-xs text-red-600 mt-1 block">كلمة المرور يجب أن تكون على الأقل 8 أحرف</span>
        }
        }
      </div>

      @if(wrong_login_data){
      <div class="w-full flex flex-col gap-2">
        <span class="px-2 text-xs text-red-600 mt-1 block">{{error_message}}</span>
        <span class="px-2 text-xs text-red-600 mt-1 block">كلمة السر او رقم الجوال غير صحيح</span>
      </div>
      }

      <button type="submit" class="buttons w-full">تسجيل الدخول</button>
    </form>
    }

    <!-- تسجيل الدخول بالموبايل -->
    @if (loginMethod === 'phone') {
    <!-- الخطوة الأولى -->
    @if (phoneStep === 'enter') {
    <form [formGroup]="loginForm_phone_otp" (ngSubmit)="check_phone_send_otp()" class="max-w-sm mx-auto">
      <div class="mb-5">
        <label class="block mb-2 text-sm font-medium">رقم الجوال</label>
        <input maxlength="10" type="text" formControlName="phoneNumber" class="input"
          placeholder=" ادخل رقم الجوال لأرسال رمز التحقق" />
        @if (loginForm_phone_otp.get('phoneNumber')?.touched && loginForm_phone_otp.get('phoneNumber')?.invalid) {
        @if (loginForm_phone_otp.get('phoneNumber')?.errors?.['required']) {
        <span class="px-2 text-xs text-red-600 mt-1 block">رقم الجوال مطلوب*</span>
        }
        @if (loginForm_phone_otp.get('phoneNumber')?.errors?.['pattern']) {
        <span class="px-2 text-xs text-red-600 mt-1 block">يجب أن يتكون رقم الجوال من 10 أرقام</span>
        }
        }
      </div>

      @if(wrong_login_data){
      <span class="px-2  text-red-600 mt-1 block">خطأ تسجيل الدخول !</span>
      <span class="px-2  text-red-600 mt-1 block">{{error_message}}</span>
      }
      <button type="submit" class="buttons w-full">إرسال رمز التحقق</button>
    </form>
    }

    <!-- الخطوة الثانية -->
    @if (phoneStep === 'verify') {
    <div class="max-w-sm mx-auto">
      <div class="mb-4 text-center text-gray-700">
        تم إرسال رمز التحقق إلى: <span class="font-semibold">{{ phoneToVerify }}</span>
        <button class="text-red-600 mx-2 text-sm ml-2 underline" (click)="backToPhoneEntry()">تغيير</button>
      </div>

      <form [formGroup]="loginForm_phone_otp" (ngSubmit)="loginWithPhone()">
        <div class="flex justify-center gap-2 mb-5 flex-row-reverse">
          @for ( one_input of otpArray; track $index) {
          <input #otpInput [attr.data-index]="$index" maxlength="1" type="text"
            class="w-12 h-12 text-center border rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            [formControlName]="'digit' + $index" (input)="handleOtpInput($event, $index)"
            (keydown)="handleOtpKeyDown($event, $index)" />
          }

        </div>
        <!-- <span class="px-2 text-xs text-red-600 mt-1 block">يجب أن يتكون رقم الجوال من 10 أرقام</span> -->
        <button class="text-red-600 mx-2 text-sm ml-2 underline" (click)="backToPhoneEntry()">ارسال الرمز مرة اخرى
        </button>


        @if(wrong_login_data){
        <span class="px-2 text-xs text-red-600 mt-1 block"> رمز التحقق غير صحيح</span>
        }

        <button type="submit" class="buttons w-full">تسجيل الدخول</button>



      </form>
    </div>
    }



    <button class="text-red-600 font-bold underline text-sm mt-4 block mx-auto" (click)="switchLoginMethod()">
      الدخول برقم الجوال و كلمة المرور
    </button>

    }





  </div>

  <div class="relative w-full md:w-[50%] p-7 hidden md:block">
    <img src="media/login.png" alt="Login Image" class="rounded-2xl w-full h-full object-cover" />
    <img src="media/Logo.png" alt="Logo" class="absolute top-6 left-[75%] w-44 h-44" />
  </div>

  <div routerLink="/about-us" id="about-us-button">
    <span class="text-2xl  text-white ">من نحن </span>
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="lucide lucide-external-link-icon lucide-external-link">
      <path d="M15 3h6v6" />
      <path d="M10 14 21 3" />
      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
    </svg>
  </div>
</div>