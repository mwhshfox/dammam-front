<div class="all_table relative overflow-x-auto">

    <!-- <form  class="max-w-md mx-auto mb-8">
        <div class="relative">
            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                <svg class="w-4 h-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                </svg>
            </div>
            <input type="search" class="crud_input block w-full p-4 ps-10"
                placeholder="ابحث عن الرحلة ..." />
            <button (click)="get_searched_trips()" type="button"
                class="text-white absolute end-2.5 bottom-2.5 px-3 py-2 thirdry_bg rounded-xl">بحث</button>
        </div>
    </form> -->

    <h3 class="text-center  mb-8 text-[#4d4c81] text-2xl font-bold">
        {{report_name }}
    </h3>




    <form class="  mb-5  w-full flex justify-between items-center" [formGroup]="trip_search_form"
        (ngSubmit)="get_report()">
        <!-- <label for="default-search" class="mb-2 text-sm font-medium text-gray-900 sr-only">ابحث هنا ....</label> -->
        <div class="flex gap-4 items-center   ">
            @if(report_type == 'departure' || report_type == 'return' || report_type == 'motabaky') {
            <div class="relative 2xl:w-[300px] xl:w-[250px] flex gap-4 items-center">
                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                    <svg class="w-4 h-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 20 20">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                    </svg>
                </div>
                <input type="search" id="default-search" formControlName="tripCode"
                    class="crud_input block w-full p-4 ps-10" placeholder="ادخل كود الرحلة ...." />
            </div>

            <input type="date" id="default-search" formControlName="date"
                class="crud_input block 2xl:w-[300px] xl:w-[250px] p-4 " placeholder="ادخل من تاريخ ...." />
            }
            @if(report_type == 'available') {
            <input type="date" id="default-search" formControlName="departureTime"
                class="crud_input block 2xl:w-[300px] xl:w-[250px] p-4 " placeholder="ابحث إلى تاريخ ...." />
            }

            @if(report_type == 'reserved-rooms') {
            <input type="date" id="default-search" formControlName="startDate"
                class="crud_input block 2xl:w-[300px] xl:w-[250px] p-4 " placeholder="تاريخ البداية" />
            <input type="date" id="default-search" formControlName="endDate"
                class="crud_input block 2xl:w-[300px] xl:w-[250px] p-4 " placeholder="تاريخ النهاية" />
            }

            <div class=" flex gap-2 items-center ps-3">
                <button type="submit" class="text-white  px-3 py-2 thirdry_bg rounded-xl">بحث</button>
                @if(trip_search_form.value.tripCode || trip_search_form.value.date ||
                trip_search_form.value.departureTime || trip_search_form.value.startDate || trip_search_form.value.endDate){
                <button type="button" (click)="cancel_search()"
                    class="text-white  px-3 py-2 main_bg rounded-xl">الغاء</button>
                }
            </div>
        </div>

        @if((report_data.length > 0 || available_report_data.length > 0) && report_type != 'reserved-rooms'){
        <div class="flex justify-center items-center gap-2  py-1 pb-3 text-gray-600  ">
            <button class="text-white  px-3 py-2 main_bg secondry_btn rounded-xl" (click)="download_pdf()">
                تنزيل التقرير
                <i class="fa-solid fa-file-arrow-down"></i>
            </button>
            <button class="text-white  px-3 py-2 thirdry_btn rounded-xl" (click)="print_pdf()">
                طباعة التقرير
                <i class="fa-solid fa-print"></i>
            </button>   
        </div>
        }

    </form>

    @if(search_code || search_date || search_departureTime || search_startDate || search_endDate){
    <div class="flex justify-center items-center w-full py-1 pb-3 text-gray-600  ">
        عرض النتائج : 
        @if(search_code){
        <span> كود الرحلة {{search_code}} -</span>
        }
        <span class="font-bold">
            تاريخ البحث : {{search_date}} {{search_departureTime}} {{search_startDate}} {{' - ' + search_endDate}}
        </span>
    </div>
    }

    @if(report_data.length > 0 || available_report_data.length > 0 || reserved_rooms_report_data.length > 0){

    @if(report_type == 'reserved-rooms') {
    <div class="w-full mb-4 bg-white shadow rounded-xl overflow-hidden">
        <div class="bg-gray-100 text-gray-600 px-4 py-3 font-semibold">
            ملخص الغرف المحجوزة
        </div>
        <div class="p-4">
            @for(item of reserved_rooms_summary; track $index) {
            <div class="border rounded-xl p-4 mb-3 bg-white">
                <div class="flex items-start justify-between gap-3 mb-1">
                    <div class="font-semibold text-[#4d4c81]">
                        {{ item.hotelName }}
                    </div>
                    <span class="px-3 py-1 rounded-full bg-indigo-50 text-indigo-700 font-semibold whitespace-nowrap">
                        الإجمالي: {{ item.totalRooms }} غرفة
                    </span>
                </div>
                <div class="text-gray-500 text-sm mb-3">
                    {{ item.hotelAddress }}
                </div>
                <div class="flex flex-wrap gap-2">
                    @for(rt of item.roomsByType; track $index) {
                    <span class="px-3 py-1 rounded-full bg-slate-100 text-slate-800 text-xs font-medium">
                        {{ rt.roomsCount }} {{ rt.roomType | enum:'room_types' }}
                    </span>
                    }
                </div>
            </div>
            }
        </div>
    </div>
    }

    <table class="w-full text-sm text-left rtl:text-right shadow rounded-xl overflow-hidden bg-white">
        <thead class="bg-gray-100 text-gray-600">
            @if(report_type == 'departure' || report_type == 'return') {
            <tr>
                <th class="px-4 py-3 text-center">#</th>
                <th class="px-4 py-3 text-center">كود الرحلة</th>
                <th class="px-4 py-3 text-center">الاسم</th>
                <th class="px-1 py-1 text-center vertical-text">العدد</th>
                <th class="px-1 py-1 text-center vertical-text">نساء</th>
                <th class="px-1 py-1 text-center vertical-text">رجال</th>
                <th class="px-4 py-3 text-center">نوع الرحلة </th>
                <th class="px-4 py-3 text-center">الفندق</th>
                <th class="px-4 py-3 text-center">رقم الفاتورة</th>
                <!-- <th class="px-4 py-3 text-center">التقارير</th> -->
            </tr>
            }

            @else if(report_type == 'motabaky') {
            <tr>
                <th class="px-4 py-3 text-center">#</th>
                <th class="px-4 py-3 text-center">كود الرحلة</th>
                <th class="px-4 py-3 text-center">الاسم</th>
                <th class="px-4 py-3 text-center">تاريخ الذهاب</th>
                <th class="px-4 py-3 text-center">المبلغ الاجمالي</th>
                <th class="px-4 py-3 text-center">المدفوع</th>
                <th class="px-4 py-3 text-center">المتبقي</th>
                <th class="px-4 py-3 text-center">رقم الفاتورة</th>
                <!-- <th class="px-4 py-3 text-center">التقارير</th> -->
            </tr>
            }
            @else if (report_type == 'available') {
            <tr>
                <th class="px-4 py-3 text-center">#</th>
                <th class="px-4 py-3 text-center">كود الرحلة</th>
                <th class="px-4 py-3 text-center">عدد المقاعد الاجمالي</th>
                <th class="px-1 py-1 text-center ">المتاح في باص الذهاب</th>
                <th class="px-1 py-1 text-center ">المتاح في باص العودة</th>
                <th class="px-4 py-3 text-center">تاريخ الذهاب </th>
                <th class="px-4 py-3 text-center">تاريخ العودة</th>
            </tr>
            }

            @else if (report_type == 'reserved-rooms') {
            <tr>
                <th class="px-4 py-3 text-center">#</th>
                <th class="px-4 py-3 text-center">الفندق</th>
                <th class="px-4 py-3 text-center">العنوان</th>
                <th class="px-4 py-3 text-center">من</th>
                <th class="px-4 py-3 text-center">إلى</th>
                <th class="px-4 py-3 text-center">نوع الغرفة</th>
                <th class="px-4 py-3 text-center">عدد الغرف</th>
            </tr>
            }

        </thead>

        <tbody>
            @if(report_type == 'departure' || report_type == 'return') {
            <!--    ==================== تقرير ذهاب و عوةدات ليوم معين ==================== -->
            @for(item of report_data ; track $index) {
            <tr class="border-t hover:bg-gray-50 transition">
                <td class="px-4 py-3 text-center">{{ $index + 1 }}</td>
                <td class="px-4 py-3 text-center font-semibold text-[#4d4c81]">{{ item.tripDto.tripCode}}</td>

                <td class="px-4 py-3 text-center">
                    {{ item.reservation.ticket.customersTickets[0].customer.fullName}}
                </td>

                <td class="px-1 py-1 text-center">
                    {{ item.reservation.ticket.customersTickets.length}}
                </td>
                <td class="px-1 py-1 text-center">
                    {{ item.femaleCount}}
                </td>
                <td class="px-1 py-1 text-center">
                    {{ item.maleCount}}
                </td>

                <td class="px-2 py-4 text-center">
                    {{ item.reservation.ticket.tripTicketType | enum:'tripTicketType'}}
                </td>

                <td class="px-2 py-4 text-center">
                    {{ item.reservation.residence?.hotelDto?.name || 'لا يوجد' }}
                </td>

                <td class="px-2 py-4 text-center">
                    {{ item.reservation.invoiceNumber}}
                </td>

            </tr>
            @if($index == report_data.length - 1){
            <tr class="border-t hover:bg-gray-50 transition">

                <!-- <td colspan="2" class="px-4 py-3 text-center"></td> -->
                <td colspan="3" class="px-4 py-3 font-semibold text-center">المجموع</td>
                <td colspan="4" class="px-1 py-3 font-semibold text-start">{{ totalCustomers }} افراد</td>
            </tr>
            }
            }

            }

            @if(report_type == 'motabaky') {
            <!--    ==================== تقرير ذهاب و عوةدات ليوم معين ==================== -->
            @for(item of report_data ; track $index) {
            <tr class="border-t hover:bg-gray-50 transition">
                <td class="px-4 py-3 text-center">{{ $index + 1 }}</td>
                <td class="px-4 py-3 text-center font-semibold text-[#4d4c81]">{{ item.tripCode}}</td>

                <td class="px-4 py-3 text-center">
                    {{ item.user?.fullName}}
                </td>

                <td class="px-1 py-1 text-center">
                    <!-- {{ item.departureTime }} -->
                     {{(item.departureTime | date: 'MM-dd (EEEE)' : '' : 'ar-EG') || '-'}}
                </td>
                <td class="px-1 py-1 text-center">
                    {{ item.totalTripAmount}}
                </td>
                <td class="px-1 py-1 text-center">
                    {{ item.paidAmount}}
                </td>
                <td class="px-1 py-1 text-center bg-yellow-100" style="font-weight: 500;" >
                    {{ item.remainingAmount}}
                </td>

                <!-- <td class="px-1 py-1 text-center">
                    {{ item.reservation.ticket.customersTickets.length}}
                </td>
                <td class="px-1 py-1 text-center">
                    {{ item.femaleCount}}
                </td>
                <td class="px-1 py-1 text-center">
                    {{ item.maleCount}}
                </td>

                <td class="px-2 py-4 text-center">
                    {{ item.reservation.ticket.tripTicketType | enum:'tripTicketType'}}
                </td>

                <td class="px-2 py-4 text-center">
                    {{ item.reservation.residence?.hotelDto?.name || 'لا يوجد' }}
                </td> -->

                <td class="px-2 py-4 text-center">
                    {{ item.invoiceNumber}}
                </td>

            </tr>
            @if($index == report_data.length - 1){
            <tr class="border-t hover:bg-gray-50 transition">

                <!-- <td colspan="2" class="px-4 py-3 text-center"></td> -->
                <td colspan="4" class="px-4 py-3 font-semibold text-end">مجموع اجمالي المتبقي</td>
                <td colspan="3" class="px-1 py-3 font-semibold text-end">{{ totalmotabaky_money || 0 }} ر.س </td>
            </tr>
            }
            }

            }

            @if(report_type == 'available') {
            <!--    ==================== تقرير اجمالي المتاح ليوم معين ==================== -->
            @for(item of available_report_data ; track $index) {
            <tr class="border-t hover:bg-gray-50 transition">
                <td class="px-4 py-3 text-center">{{ $index + 1 }}</td>
                <td class="px-4 py-3 text-center font-semibold text-[#4d4c81]">{{ item.tripCode}}</td>

                <td class="px-4 py-3 text-center">
                    {{ item.numberOfChairs}}
                </td>

                <td class="px-1 py-1 text-center">
                    {{ item.availableDeparture}}
                </td>
                <td class="px-1 py-1 text-center">
                    {{ item.availableReturn}}
                </td>
                <td class="px-1 py-1 text-center">
                    {{ item.departureTime | date:'yyyy-MM-dd'}}
                </td>
                <td class="px-1 py-1 text-center">
                    {{ item.returnTime | date:'yyyy-MM-dd'}}
                </td>
            </tr>

            }
            }

            @if(report_type == 'reserved-rooms') {
            @for(item of reserved_rooms_report_data ; track $index) {
            <tr class="border-t hover:bg-gray-50 transition">
                <td class="px-4 py-3 text-center">{{ $index + 1 }}</td>
                <td class="px-4 py-3 text-center font-semibold text-[#4d4c81]">{{ item.hotelName }}</td>
                <td class="px-4 py-3 text-center">{{ item.hotelAddress }}</td>
                <td class="px-4 py-3 text-center">{{ item.residenceFrom | date:'yyyy-MM-dd' }}</td>
                <td class="px-4 py-3 text-center">{{ item.residenceTo | date:'yyyy-MM-dd' }}</td>
                <td class="px-4 py-3 text-center">{{ item.roomType | enum:'room_types' }}</td>
                <td class="px-4 py-3 text-center">{{ item.roomsCount }}</td>
            </tr>
            }
            }
        </tbody>
    </table>
    }
    @else {
    <div class="flex justify-center items-center h-full py-40">
        <p>{{ search_code || search_date || search_departureTime || search_startDate || search_endDate ? 'لا يوجد بيانات' : 'قم بادخال بيانات البحث'}}</p>
    </div>
    }
</div>