<!-- date-picker.component.html -->
<div class="relative" [class.w-[300px]]="defaultwidth">
  <!-- Input Field -->
  <div class="relative"  [class.w-[300px]]="defaultwidth">
    <input #dateInput type="text" [value]="displayValue" [placeholder]="placeholder" [disabled]="disabled"
      (click)="toggleCalendar()" (focus)="showCalendar = true" readonly class="absolute inset-0 opacity-0 z-10"
      [class.bg-gray-100]="disabled" [class.cursor-not-allowed]="disabled" />
    <div
      class="flex items-center justify-between bg-[#F9F9F9] rounded-[12px] px-4 py-2 text-[#878CBD] z-0 pointer-events-none"
      style="padding: 0.875rem;">
      <span class="truncate">
        {{ displayValue || placeholder }}
      </span>
      <svg class="w-4 h-4 shrink-0" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
        <path
          d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z" />
      </svg>
    </div>
  </div>


  <!-- Custom Calendar Dropdown -->
  <div *ngIf="showCalendar && !disabled"
    class="absolute z-50 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-4 w-80 left-[-10px]"
    style="direction: rtl;">
    <!-- Header -->
    <div class="flex items-center justify-between mb-4">

      <button type="button" (click)="previousMonth()"
        class="p-1 hover:bg-gray-100 rounded-full transition-colors duration-200">
        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>

      <div class="text-lg font-semibold text-gray-900">
        {{ getArabicMonthName(currentMonth) }} {{ currentYear }}
      </div>


      <button type="button" (click)="nextMonth()"
        class="p-1 hover:bg-gray-100 rounded-full transition-colors duration-200">
        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
    </div>

    <!-- Days of Week -->
    <div class="grid grid-cols-7 gap-1 mb-2">
      <div *ngFor="let day of arabicDaysOfWeek" class="text-center text-sm font-medium text-gray-500 p-2">
        {{ day }}
      </div>
    </div>

    <!-- Calendar Days -->
    <div class="grid grid-cols-7 gap-1">
      <button *ngFor="let day of calendarDays" type="button" [disabled]="!day.enabled || isDateDisabled(day.date)"
        (click)="selectDate(day.date)" class="date_number_btn p-2 text-sm rounded-lg transition-all duration-200"
        [class.selected_bg]="isSameDate(day.date, selectedDate)"
        [class.text-gray-400]="!day.currentMonth"
        [class.font-bold]="day.selected"
        [class.cursor-not-allowed]="!day.enabled || isDateDisabled(day.date)"
        [class.opacity-50]="!day.enabled || isDateDisabled(day.date)">
        {{ day.date.getDate() }}
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-between mt-4 pt-3 border-t border-gray-200">
      <button type="button" (click)="clearDate()"
        class="px-3 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors duration-200">
        مسح
      </button>
      <button type="button" (click)="selectToday()" [disabled]="isTodayDisabled()"
        class="today_btn px-3 py-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed">
        اليوم
      </button>
    </div>
  </div>
</div>

<!-- Overlay to close calendar when clicking outside -->
<div *ngIf="showCalendar" class="fixed inset-0 z-40" (click)="showCalendar = false"></div>